import React, { useState, useEffect } from "react";
import {
  Row,
  Col,
  Form,
  Input,
  Button,
  Checkbox,
  Avatar,
  notification,
} from "antd";
import { notificaionTitle } from "../constants";
import { UserOutlined, MailOutlined, LockOutlined } from "@ant-design/icons";
import { useDispatch, useSelector } from "react-redux";
import { Redirect } from "react-router-dom";
import { login } from "../slices/auth";
import { clearMessage } from "../slices/message";
import { Card } from "antd";

const Login = (props) => {
  const { isLoggedIn } = useSelector((state) => state.auth);
  const { message } = useSelector((state) => state.message);
  const [form] = Form.useForm();
  const [, forceUpdate] = useState({}); // To disable submit button at the beginning.
  const dispatch = useDispatch();
  useEffect(() => {
    forceUpdate({});
  }, []);
  useEffect(() => {
    dispatch(clearMessage());
  }, [dispatch]);

  const handleLogin = (formValue) => {
    const { email, password } = formValue;
    dispatch(login({ email, password }))
      .unwrap()
      .then(() => {
        notification["success"]({
          message: notificaionTitle,
          description: "Welcome to" + notificaionTitle,
        });
        props.history.push("/controlpanel/dashboard");
        window.location.reload();
      })
      .catch(() => {
        message &&
          notification["error"]({
            message: notificaionTitle,
            description: message,
          });
      });
  };

  if (isLoggedIn) {
    return <Redirect to="/controlpanel/dashboard" />;
  }
  return (
    <>
      <div style={{ height: "10vh" }}></div>
      <Row
        style={{
          padding: "5px",
          justifyContent: "center",
          alignItems: "center",
        }}
      >
        <Col>
          <Card style={{ width: "100%" }}>
            <Row align="center">
              <Avatar
                size="large"
                style={{
                  color: "#f56a00",
                  backgroundColor: "#fde3cf",
                  width: "80px",
                  height: "80px",
                  marginBottom: 20,
                }}
                icon={
                  <UserOutlined style={{ fontSize: "50px", marginTop: 10 }} />
                }
              >
                Hi
              </Avatar>
            </Row>
            <Row align="center">
              <Form
                name="normal_login"
                form={form}
                initialValues={{
                  remember: true,
                }}
                style={{ width: 300 }}
                onFinish={handleLogin}
              >
                <Form.Item
                  name="email"
                  rules={[
                    {
                      type: "email",
                      message: "The input is not valid E-mail!",
                    },
                    {
                      required: true,
                      message: "Please input your Email!",
                    },
                  ]}
                >
                  <Input prefix={<MailOutlined />} placeholder="Email" />
                </Form.Item>
                <Form.Item
                  name="password"
                  rules={[
                    {
                      required: true,
                      message: "Please input your Password!",
                    },
                  ]}
                >
                  <Input
                    prefix={<LockOutlined />}
                    type="password"
                    placeholder="Password"
                  />
                </Form.Item>
                <Form.Item>
                  <Form.Item name="remember" valuePropName="checked" noStyle>
                    <Checkbox style={{ float: "left" }}>Remember me</Checkbox>
                  </Form.Item>

                  <a
                    className="login-form-forgot"
                    style={{ float: "right" }}
                    href="##"
                  >
                    Forgot password
                  </a>
                </Form.Item>
                <Form.Item>
                  <Button type="primary" htmlType="submit" block>
                    Log in
                  </Button>
                  Or <a href="/register">register now!</a>
                </Form.Item>
              </Form>
            </Row>
          </Card>
        </Col>
      </Row>
      <div style={{ height: "35vh" }}></div>
    </>
  );
};

export default Login;
